<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="../../favicon.ico">

	<title>Library Traffic Data Dashboard</title>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
	<link rel="stylesheet" type="text/css" href="css/styles.css">

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">MIP Traffic Data Dashboard</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Reports <span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="avgTraffic.html">Average Traffic</a></li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container" id="main">


		<h2>Average Traffic by Area <small>1 = Full, 5 = Empty</small></h2>
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
				<div id="chart"></div>
			</div>
		</div>
		<form onsubmit="return false;">
			<div class="row">
				<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
					<h2>Include Dates</h2>
					<table id="days-include">
						<thead>
							<tr>
								<th>From</th>
								<th>To</th>
								<th>&nbsp;</th>
							</tr>
						</thead>
						<tbody>
							<tr class="template">
								<td><input type="date" class="begin" name="include[begin][]"/></td>
								<td><input type="date" class="end"   name="include[end][]"/></td>
								<td><button class="btn btn-danger" onclick="removeRange(this)">x</button></td>
							</tr>
						</tbody>
					</table>
					<button class="add btn btn-success">Add</button>
				</div>
				<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
					<h2>Exclude Dates</h2>
					<table id="days-exclude">
						<thead>
							<tr>
								<th>From</th>
								<th>To</th>
								<th>&nbsp;</th>
							</tr>
						</thead>
						<tbody>
							<tr class="template">
								<td><input type="date" class="begin" name="exclude[begin][]" /></td>
								<td><input type="date" class="end"   name="exclude[end][]"/></td>
								<td><button class="btn btn-danger" onclick="removeRange(this);">x</button></td>
							</tr>
						</tbody>
					</table>
					<button class="add btn btn-success">Add</button>
				</div>
				<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
					<h2>Filter Data</h2>
					<button type="submit" class="add btn btn-info" onclick="drawChart();">Filter</button>
				</div>
			</div>
			
		</form>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		jQuery(window).resize(function(){
			drawChart(false);
		});
		jQuery(document).ready(function(){
			jQuery('.add').click(function(){
				jQuery(this).parent().find('.template').after((jQuery(this).parent().find('.template').clone()).removeClass());
			});
		});
		
			
		function removeRange(row){
			jQuery(row).parent().parent().remove();
		}
		function getRanges(){
			var ranges = {
				days: {
					exclude: [],
					include: []
				},
				hours: {
					exclude: [],
					include: [],
				}
			};

			jQuery('#days-exclude').find('tr').each(function(){
				var range = jQuery(this).find('input');
				if (range.length){
					var begin = range[0].value;
					var end = range[1].value;
					ranges.days.exclude.push([begin, end]);
				}
			});
			jQuery('#days-include').find('tr').each(function(){
				var range = jQuery(this).find('input');
				if (range.length){
					var begin = range[0].value;
					var end = range[1].value;
					ranges.days.include.push([begin, end]);
				}
			});
			return ranges;
		}
		google.load("visualization", "1", {packages:["corechart"]});
		google.setOnLoadCallback(drawChart);
		function drawChart(refresh) {
			var xhr = new XMLHttpRequest();
			xhr.open('GET','php/avgTraffic.php?' + jQuery('form').serialize(),false);
			xhr.send();


			var data = new google.visualization.DataTable();
			data.addColumn('string', 'Area');
			data.addColumn('number', 'Level', {role: 'annotationtext'});
			data.addColumn({type: 'string', role: 'tooltip', p:{html: true}});

			data.addRows(JSON.parse(xhr.responseText));

			var options = {
				height: 500,
				vAxis:{
					viewWindow: {
						min: 0,
						max: 6
					},
					title: 'Traffic Level'
				},
				hAxis:{
					title: 'Area'
				},
				tooltip:{
					isHtml: true
				}
			};

			var chart = new google.visualization.ColumnChart(document.getElementById('chart'));

			chart.draw(data, options);
			return false;
		}
	</script>
</body>
</html>
